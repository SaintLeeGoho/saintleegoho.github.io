(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{445:function(a,s,t){a.exports=t.p+"assets/img/Flume解决的问题.0edab6a3.png"},446:function(a,s,t){a.exports=t.p+"assets/img/Flume解决的问题2.c0091fe3.png"},447:function(a,s,t){a.exports=t.p+"assets/img/Flume的工作机制.1d2573c3.png"},448:function(a,s,t){a.exports=t.p+"assets/img/Flume多级Agent串联.7ec89f42.png"},513:function(a,s,t){"use strict";t.r(s);var n=t(2),e=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"flume"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#flume"}},[a._v("#")]),a._v(" Flume")]),a._v(" "),s("h2",{attrs:{id:"_1-flume解决的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-flume解决的问题"}},[a._v("#")]),a._v(" 1.Flume解决的问题")]),a._v(" "),s("p",[s("img",{attrs:{src:t(445),alt:"image-20230717000818688"}})]),a._v(" "),s("p",[s("img",{attrs:{src:t(446),alt:"image-20230717001255645"}})]),a._v(" "),s("h2",{attrs:{id:"_2-flume概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-flume概念"}},[a._v("#")]),a._v(" 2.Flume概念")]),a._v(" "),s("p",[a._v("Flume是Cloudera提供的一个高可用的，高可靠的，分布式的海量日志采集、聚合和传输的系统。Flume基于流式架构，灵活简单。")]),a._v(" "),s("h2",{attrs:{id:"_3-flume的工作机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-flume的工作机制"}},[a._v("#")]),a._v(" 3.Flume的工作机制")]),a._v(" "),s("p",[s("img",{attrs:{src:t(447),alt:"image-20230717085549235"}})]),a._v(" "),s("h2",{attrs:{id:"_4-flume组成架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-flume组成架构"}},[a._v("#")]),a._v(" 4.Flume组成架构")]),a._v(" "),s("h3",{attrs:{id:"_4-1-agent"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-agent"}},[a._v("#")]),a._v(" 4.1 Agent")]),a._v(" "),s("p",[a._v("Agent是一个JVM进程，它以事件的形式将数据从源头送至目的，是Flume数据传输的基本单元。")]),a._v(" "),s("p",[a._v("Agent主要有3个部分组成，Source、Channel、Sink。")]),a._v(" "),s("h3",{attrs:{id:"_4-2-source"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-source"}},[a._v("#")]),a._v(" 4.2 Source")]),a._v(" "),s("p",[a._v("Source是负责接收数据到Flume Agent的组件。Source组件可以处理各种类型、各种格式的日志数据，包括avro、thrift、exec、jms、spooling directory、netcat、sequence generator、syslog、http、legacy。")]),a._v(" "),s("h3",{attrs:{id:"_4-3-channel"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-channel"}},[a._v("#")]),a._v(" 4.3 Channel")]),a._v(" "),s("p",[a._v("Channel是位于Source和Sink之间的缓冲区。因此，Channel允许Source和Sink运作在不同的速率上。Channel是线程安全的，可以同时处理几个Source的写入操作和几个Sink的读取操作。")]),a._v(" "),s("p",[a._v("Flume自带两种Channel：Memory Channel和File Channel。")]),a._v(" "),s("p",[a._v("Memory Channel是内存中的队列。Memory Channel在不需要关心数据丢失的情景下适用。如果需要关心数据丢失，那么Memory Channel就不应该使用，因为程序死亡、机器宕机或者重启都会导致数据丢失。")]),a._v(" "),s("p",[a._v("File Channel将所有事件写到磁盘。因此在程序关闭或机器宕机的情况下不会丢失数据。")]),a._v(" "),s("h3",{attrs:{id:"_4-4-sink"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-sink"}},[a._v("#")]),a._v(" 4.4 Sink")]),a._v(" "),s("p",[a._v("Sink不断地轮询Channel中的事件且批量地移除它们，并将这些事件批量写入到存储或索引系统、或者被发送到另一个Flume Agent。")]),a._v(" "),s("p",[a._v("Sink是完全事务性的。在从Channel批量删除数据之前，每个Sink用Channel启动一个事务。批量事件一旦成功写出到存储系统或下一个Flume Agent，Sink就利用Channel提交事务。事务一旦被提交，该Channel从自己的内部缓冲区删除事件。")]),a._v(" "),s("p",[a._v("Sink组件目的地包括hdfs、logger、avro、thrift、ipc、file、null、HBase、solr、自定义。")]),a._v(" "),s("h3",{attrs:{id:"_4-5-event"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-event"}},[a._v("#")]),a._v(" 4.5 Event")]),a._v(" "),s("p",[a._v("传输单元，Flume数据传输的基本单元，以事件的形式将数据从源头送至目的地。")]),a._v(" "),s("h2",{attrs:{id:"_5-flume的安装部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-flume的安装部署"}},[a._v("#")]),a._v(" 5.Flume的安装部署")]),a._v(" "),s("h3",{attrs:{id:"_5-1-flume下载地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-flume下载地址"}},[a._v("#")]),a._v(" 5.1 Flume下载地址")]),a._v(" "),s("p",[a._v("1）Flume官网地址")]),a._v(" "),s("p",[a._v("http://flume.apache.org/")]),a._v(" "),s("p",[a._v("2）文档查看地址")]),a._v(" "),s("p",[a._v("http://flume.apache.org/FlumeUserGuide.html")]),a._v(" "),s("p",[a._v("3）下载地址")]),a._v(" "),s("p",[s("a",{attrs:{href:"http://archive.apache.org/dist/flume/",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://archive.apache.org/dist/flume/"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"_5-2-安装部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-安装部署"}},[a._v("#")]),a._v(" 5.2 安装部署")]),a._v(" "),s("p",[a._v("1）将apache-flume-1.7.0-bin.tar.gz上传到linux的/opt/software目录下")]),a._v(" "),s("p",[a._v("2）解压apache-flume-1.7.0-bin.tar.gz到/opt/module/目录下")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("hadoop01@hadoop01 software"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxf")]),a._v(" apache-flume-1.7.0-bin.tar.gz "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" /opt/module/\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("3）修改apache-flume-1.7.0-bin的名称为flume")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("hadoop01 @hadoop01 module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" apache-flume-1.7.0-bin flume\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("4） 将flume/conf下的flume-env.sh.template文件修改为flume-env.sh，并配置flume-env.sh文件")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("hadoop01@ hadoop01 conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" flume-env.sh.template flume-env.sh\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("hadoop01@ hadoop01 conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" flume-env.sh\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("export JAVA_HOME=/opt/module/jdk1.8.0_144\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"_6-flume实践案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-flume实践案例"}},[a._v("#")]),a._v(" 6.Flume实践案例")]),a._v(" "),s("h3",{attrs:{id:"_6-1-采集目录中的新文件到hdfs中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-采集目录中的新文件到hdfs中"}},[a._v("#")]),a._v(" 6.1 采集目录中的新文件到HDFS中")]),a._v(" "),s("p",[s("strong",[a._v("采集需求：使用flume监听整个目录的文件")])]),a._v(" "),s("h4",{attrs:{id:"_6-1-1-flume要想将数据输出到hdfs-必须持有hadoop相关jar包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-1-flume要想将数据输出到hdfs-必须持有hadoop相关jar包"}},[a._v("#")]),a._v(" 6.1.1 Flume要想将数据输出到HDFS，必须持有Hadoop相关jar包")]),a._v(" "),s("p",[a._v("将commons-configuration-1.6.jar、hadoop-auth-2.7.2.jar、hadoop-common-2.7.2.jar、hadoop-hdfs-2.7.2.jar、commons-io-2.4.jar、htrace-core-3.1.0-incubating.jar拷贝到/opt/module/flume/lib文件夹下。")]),a._v(" "),s("p",[a._v("尖叫提示：标红的jar为1.99版本flume必须引用的jar。其他版本可以不引用。")]),a._v(" "),s("h4",{attrs:{id:"_6-1-2-创建flume-file-hdfs-conf文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-2-创建flume-file-hdfs-conf文件"}},[a._v("#")]),a._v(" 6.1.2 创建flume-file-hdfs.conf文件")]),a._v(" "),s("p",[a._v("创建文件")]),a._v(" "),s("p",[a._v("[hadoop02@hadoop02 flume]$ touch dir-hdfs.conf")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#定义三大组件的名称")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("source1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("sink1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("channel1")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置source组件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources.source1.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("spooldir")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources.source1.spoolDir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/root/log/")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources.source1.fileSuffix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v(".FINISHED")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#ag1.sources.source1.deserializer.maxLineLength=5120")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置sink组件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("hdfs")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.path")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("hdfs://hadoop01:9000/access_log/%y-%m-%d/%H-%M")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.filePrefix")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("app_log")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.fileSuffix")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v(".log")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.batchSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("100")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.fileType")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("DataStream")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.writeFormat")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Text")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## roll：滚动切换：控制写文件的切换规则")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 按文件体积（字节）来切")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.rollSize")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("512000 ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 按event条数切     ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.rollCount")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1000000  ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 按时间间隔切换文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.rollInterval")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("60    ")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 控制生成目录的规则")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.round")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.roundValue")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("10")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.roundUnit")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("minute")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.useLocalTimeStamp")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# channel组件配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels.channel1.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("memory")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## event条数")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels.channel1.capacity")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("500000   ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("##flume事务控制所需要的缓存容量600条event")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels.channel1.transactionCapacity")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("600")]),a._v("\n  \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 绑定source、channel和sink之间的连接")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources.source1.channels")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("channel1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.channel")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("channel1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br"),s("span",{staticClass:"line-number"},[a._v("42")]),s("br"),s("span",{staticClass:"line-number"},[a._v("43")]),s("br"),s("span",{staticClass:"line-number"},[a._v("44")]),s("br"),s("span",{staticClass:"line-number"},[a._v("45")]),s("br")])]),s("h4",{attrs:{id:"_6-1-3-启动flume采集命令-测试阶段下使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-3-启动flume采集命令-测试阶段下使用"}},[a._v("#")]),a._v(" 6.1.3 启动Flume采集命令(测试阶段下使用)")]),a._v(" "),s("p",[a._v("日志打印到控制台启动命令：")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@hadoop01 flume"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# bin/flume-ng agent -c conf -f dir-hdfs.conf -n ag1 -Dflume.root.logger=INFO,console")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("重要说明： 在使用Spooling Directory Source时")]),a._v(" "),s("p",[a._v("1) 不要在监控目录中创建并持续修改文件")]),a._v(" "),s("p",[a._v("2) 采集完成的文件会以.FINISHED结尾")]),a._v(" "),s("p",[a._v("3) 被监控文件夹每600毫秒扫描一次文件变动")]),a._v(" "),s("h4",{attrs:{id:"_6-1-4-启动flume采集命令-生产环境下使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-4-启动flume采集命令-生产环境下使用"}},[a._v("#")]),a._v(" 6.1.4 启动Flume采集命令(生产环境下使用)")]),a._v(" "),s("p",[a._v("在生产环境中,启动flume,应该把flume启动在后台,在服务器一直运行采集")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@hadoop01 flume"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# nohup bin/flume-ng agent -c conf -f dir-hdfs.conf -n ag1 1>/dev/null 2>&1 &")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_6-2-采集文件新增内容到hdfs中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-采集文件新增内容到hdfs中"}},[a._v("#")]),a._v(" 6.2 采集文件新增内容到HDFS中")]),a._v(" "),s("p",[a._v("采集需求:比如业务系统使用log4j生成日志,日志内容不断添加,需要把追加的日志实时采集到hdfs存储.")]),a._v(" "),s("h4",{attrs:{id:"_6-2-1-需求分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-1-需求分析"}},[a._v("#")]),a._v(" 6.2.1 需求分析")]),a._v(" "),s("p",[a._v("根据需求首先定义以下3大要素:")]),a._v(" "),s("p",[a._v("采集源: 即是source--监控文件内容的更新: exec 'tail -F file'")]),a._v(" "),s("p",[a._v("下沉目标: 即是sink --HDFS文件系统 : hdfs sink")]),a._v(" "),s("p",[a._v("source与sink的传递通道-- channel, 可用file channel 也可以用memory channel.")]),a._v(" "),s("h4",{attrs:{id:"_6-2-2-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-2-实现"}},[a._v("#")]),a._v(" 6.2.2 实现")]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#定义三大组件的名称")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("source1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("sink1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("channel1")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置source组件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources.source1.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("exec")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources.source1.command")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("tail -F /root/log/access.log")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置sink组件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("hdfs")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.path")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("hdfs://hadoop01:9000/access_log/%y-%m-%d")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.filePrefix")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("app_log")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.fileSuffix")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v(".log")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.batchSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("100")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.fileType")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("DataStream")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.writeFormat")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("Text")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## roll：滚动切换：控制写文件的切换规则")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 按文件体积（字节）来切   ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.rollSize")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("512000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 按event条数切")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.rollCount")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1000000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 按时间间隔切换文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.rollInterval")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("60")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 控制生成目录的规则")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.round")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.roundValue")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("10")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.roundUnit")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("minute")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.useLocalTimeStamp")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# channel组件配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels.channel1.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("memory")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## event条数")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels.channel1.capacity")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("500000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("##flume事务控制所需要的缓存容量600条event")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels.channel1.transactionCapacity")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("600")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 绑定source、channel和sink之间的连接")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources.source1.channels")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("channel1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.channel")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("channel1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br"),s("span",{staticClass:"line-number"},[a._v("42")]),s("br")])]),s("h4",{attrs:{id:"_6-2-3-写入数据测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-3-写入数据测试"}},[a._v("#")]),a._v(" 6.2.3 写入数据测试")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@hadoop01 log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# while true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("data"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" access.log\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sleep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h3",{attrs:{id:"_6-3-多级agent串联"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-多级agent串联"}},[a._v("#")]),a._v(" 6.3 多级agent串联")]),a._v(" "),s("p",[s("img",{attrs:{src:t(448),alt:"image-20230717103029485"}})]),a._v(" "),s("h4",{attrs:{id:"_6-3-1配置hadoop02监听服务端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-1配置hadoop02监听服务端"}},[a._v("#")]),a._v(" 6.3.1配置hadoop02监听服务端")]),a._v(" "),s("ol",[s("li",[a._v("配置文件avro-hdfs.conf")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@hadoop01 flume"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# vim avro-hdfs.conf")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#定义三大组件的名称")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("source1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("sink1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("channel1")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置source组件,该source的avro组件是一个接收者的服务")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources.source1.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("avro")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources.source1.bind")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("hadoop02")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources.source1.port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("4141 ")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置sink组件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("hdfs")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.path")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("hdfs://hadoop01:9000/flume/taildata/%y-%m-%d/")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.filePrefix")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("tail-")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.round")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.roundValue")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("24")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.roundUnit")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("hour")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.rollInterval")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.rollSize")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.rollCount")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("50")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.batchSize")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("10")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.useLocalTimeStamp")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#生成的文件类型，默认是Sequencefile，可用DataStream，则为普通文本")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hdfs.fileType")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("DataStream")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# channel组件配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels.channel1.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("memory")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## event条数")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels.channel1.capacity")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("##flume事务控制所需要的缓存容量100条event")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels.channel1.transactionCapacity")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("100")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 绑定source、channel和sink之间的连接")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources.source1.channels")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("channel1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.channel")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("channel1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br")])]),s("ol",{attrs:{start:"2"}},[s("li",[a._v("启动")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@hadoop01 flume"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# bin/flume-ng agent -c conf -f avro-hdfs.conf -n ag1 -Dflume.root.logger=INFO,console")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("ol",{attrs:{start:"3"}},[s("li",[a._v("查看是否启动监听")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@hadoop02 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# netstat -nltp")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("ol",{attrs:{start:"4"}},[s("li",[a._v("查看flume进程详情")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@hadoop02 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# jps -m")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_6-3-2-在其它节点配置监听客户端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-2-在其它节点配置监听客户端"}},[a._v("#")]),a._v(" 6.3.2 在其它节点配置监听客户端")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@hadoop01 flume"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# vim tail-avro.conf")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#定义三大组件的名称")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("source1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("sink1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("channel1")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置source组件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources.source1.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("exec")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources.source1.command")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("tail -F /root/log/access.log")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置sink组件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("avro")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.hostname")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("hadoop02")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("4141")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.batch-size")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("2")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# channel组件配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels.channel1.type")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("memory")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## event条数")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels.channel1.capacity")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1000")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("##flume事务控制所需要的缓存容量100条event")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.channels.channel1.transactionCapacity")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("100")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 绑定source、channel和sink之间的连接")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sources.source1.channels")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("channel1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("ag1.sinks.sink1.channel")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("channel1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br")])]),s("p",[a._v("启动进行测试")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@hadoop01 flume"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# bin/flume-ng agent -c conf -f tail-avro.conf -n ag1 -Dflume.root.logger=INFO,console")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("发送数据测试")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@hadoop01 flume"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# while true; do echo `date` >> access.log; sleep 0.1; done")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);