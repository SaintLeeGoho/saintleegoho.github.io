<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HDFS原理 | GohoLee</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="blog by GohoLee">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.15bca8c4.css" as="style"><link rel="preload" href="/assets/js/app.4c955a77.js" as="script"><link rel="preload" href="/assets/js/4.1f64e010.js" as="script"><link rel="preload" href="/assets/js/1.2b09ee83.js" as="script"><link rel="preload" href="/assets/js/18.a6042dc9.js" as="script"><link rel="prefetch" href="/assets/js/10.08341258.js"><link rel="prefetch" href="/assets/js/11.44b1e064.js"><link rel="prefetch" href="/assets/js/12.46caf217.js"><link rel="prefetch" href="/assets/js/13.2a24eef2.js"><link rel="prefetch" href="/assets/js/14.18303fff.js"><link rel="prefetch" href="/assets/js/15.eb41772c.js"><link rel="prefetch" href="/assets/js/16.dbac35fb.js"><link rel="prefetch" href="/assets/js/17.3881a037.js"><link rel="prefetch" href="/assets/js/19.f1b368c9.js"><link rel="prefetch" href="/assets/js/20.305a152a.js"><link rel="prefetch" href="/assets/js/21.f54a0bb0.js"><link rel="prefetch" href="/assets/js/22.e026b642.js"><link rel="prefetch" href="/assets/js/3.c860fb87.js"><link rel="prefetch" href="/assets/js/5.7d1d4fdd.js"><link rel="prefetch" href="/assets/js/6.6b47eb9b.js"><link rel="prefetch" href="/assets/js/7.1e7dcb9a.js"><link rel="prefetch" href="/assets/js/8.ff9809b2.js"><link rel="prefetch" href="/assets/js/9.30f2afa9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.15bca8c4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>GohoLee</h3> <p class="description" data-v-59e6cb88>blog by GohoLee</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>GohoLee</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/avatar.png" alt="GohoLee" class="logo"> <span class="site-name">GohoLee</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Big Data/" class="nav-link"><i class="undefined"></i>
  Big Data
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端基础/" class="nav-link"><i class="undefined"></i>
  前端基础
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      文档Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/Saint/" class="nav-link"><i class="undefined"></i>
  关于博主
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      联系Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/saintleegoho" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    GohoLee
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>12</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>11</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Big Data/" class="nav-link"><i class="undefined"></i>
  Big Data
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端基础/" class="nav-link"><i class="undefined"></i>
  前端基础
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      文档Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/Saint/" class="nav-link"><i class="undefined"></i>
  关于博主
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      联系Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/saintleegoho" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>HDFS原理</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>GohoLee</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">HDFS原理</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>GohoLee</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>7/4/2023</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>Hadoop</span><span class="tag-item" data-v-8a445198>HDFS</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="hadoop-hdfs"><a href="#hadoop-hdfs" class="header-anchor">#</a> Hadoop HDFS</h1> <h2 id="第-1-章-hdfs-概述"><a href="#第-1-章-hdfs-概述" class="header-anchor">#</a> 第 1 章 HDFS 概述</h2> <h3 id="_1-1-hdfs-产生背景"><a href="#_1-1-hdfs-产生背景" class="header-anchor">#</a> 1.1 HDFS 产生背景</h3> <p>随着数据量越来越大，在一个操作系统管辖的范围内存不下了，那么就分配到更多的操作系统管理的磁盘中，但是不方便管理和维护，迫切需要一种系统来管理多台机器上的文件，这就是分布式文件管理系统。HDFS 只是分布式文件管理系统中的一种。</p> <h3 id="_1-2-hdfs-概念"><a href="#_1-2-hdfs-概念" class="header-anchor">#</a> 1.2 HDFS 概念</h3> <p>HDFS，它是一个文件系统，用于存储文件，通过目录树来定位文件；其次，它是分布式的，由很多服务器联合起来实现其功能，集群中的服务器有各自的角色。</p> <p>HDFS 的设计适合一次写入，多次读出的场景，且不支持文件的修改。适合用来做数据分析，并不适合用来做网盘应用。</p> <h3 id="_1-3-hdfs-优缺点"><a href="#_1-3-hdfs-优缺点" class="header-anchor">#</a> 1.3 HDFS 优缺点</h3> <h4 id="_1-3-1-优点"><a href="#_1-3-1-优点" class="header-anchor">#</a> 1.3.1 优点</h4> <p>1）高容错性</p> <p>（1）数据自动保存多个副本。它通过增加副本的形式，提高容错性；</p> <p>（2）某一个副本丢失以后，它可以自动恢复。</p> <p>2）适合大数据处理</p> <p>（1）数据规模：能够处理数据规模达到 GB、TB、甚至 PB 级别的数据；</p> <p>（2）文件规模：能够处理百万规模以上的文件数量，数量相当之大。</p> <p>3）流式数据访问，它能保证数据的一致性。</p> <p>4）可构建在廉价机器上，通过多副本机制，提高可靠性。</p> <h4 id="_1-3-2-缺点"><a href="#_1-3-2-缺点" class="header-anchor">#</a> 1.3.2 缺点</h4> <p>1）不适合低延时数据访问，比如毫秒级的存储数据，是做不到的。</p> <p>2）无法高效的对大量小文件进行存储。</p> <p>（1）存储大量小文件的话，它会占用 NameNode 大量的内存来存储文件、目录和块信息。这样是不可取的，因为 NameNode 的内存总是有限的；</p> <p>（2）小文件存储的寻址时间会超过读取时间，它违反了 HDFS 的设计目标。</p> <p>3）并发写入、文件随机修改。</p> <p>（1）一个文件只能有一个写，不允许多个线程同时写；</p> <p>（2）仅支持数据 append（追加），不支持文件的随机修改。</p> <h3 id="_1-4-hdfs-组成架构"><a href="#_1-4-hdfs-组成架构" class="header-anchor">#</a> 1.4 HDFS 组成架构</h3> <p>HDFS 的架构图</p> <p>这种架构主要由四个部分组成，分别为 HDFS Client、NameNode、DataNode 和 Secondary NameNode。下面我们分别介绍这四个组成部分。</p> <p>1）Client：就是客户端。</p> <p>（1）文件切分。文件上传 HDFS 的时候，Client 将文件切分成一个一个的 Block，然后进行存储；</p> <p>（2）与 NameNode 交互，获取文件的位置信息；</p> <p>（3）与 DataNode 交互，读取或者写入数据；</p> <p>（4）Client 提供一些命令来管理 HDFS，比如启动或者关闭 HDFS；</p> <p>（5）Client 可以通过一些命令来访问 HDFS；</p> <p>2）NameNode：就是 Master，它是一个主管、管理者。</p> <p>（1）管理 HDFS 的名称空间；</p> <p>（2）管理数据块（Block）映射信息；</p> <p>（3）配置副本策略；</p> <p>（4）处理客户端读写请求。</p> <p>3） DataNode：就是 Slave。NameNode 下达命令，DataNode 执行实际的操作。</p> <p>（1）存储实际的数据块；</p> <p>（2）执行数据块的读/写操作。</p> <p>4）Secondary NameNode：并非 NameNode 的热备。当 NameNode 挂掉的时候，它并不能马</p> <p>上替换 NameNode 并提供服务。</p> <p>（1）辅助 NameNode，分担其工作量；</p> <p>（2）定期合并 Fsimage 和 Edits，并推送给 NameNode；</p> <p>（3）在紧急情况下，可辅助恢复 NameNode。</p> <h3 id="_1-5-hdfs-文件块大小"><a href="#_1-5-hdfs-文件块大小" class="header-anchor">#</a> 1.5 HDFS 文件块大小</h3> <p>HDFS 中的文件在物理上是分块存储（block），块的大小可以通过配置参数(dfs.blocksize)来规定，默认大小在 hadoop2.x 版本中是 128M，老版本中是 64M。</p> <p>HDFS 的块比磁盘的块大，其目的是为了最小化寻址开销。如果块设置得足够大，从磁盘传输数据的时间会明显大于定位这个块开始位置所需的时间。因而，传输一个由多个块组成的文件的时间取决于磁盘传输速率。</p> <p>如果寻址时间约为 10ms，而传输速率为 100MB/s，为了使寻址时间仅占传输时间的 1%，</p> <p>我们要将块大小设置约为 100MB。默认的块大小 128MB。块的大小：10ms*100*100M/s = 100M</p> <h2 id="第-2-章-hfds-的-shell-操作"><a href="#第-2-章-hfds-的-shell-操作" class="header-anchor">#</a> 第 2 章 HFDS 的 Shell 操作</h2> <p>1）基本语法</p> <p>bin/hadoop fs 具体命令</p> <p>2）命令大全</p> <p>[root@hadoop02 hadoop-2.7.2]$ bin/hadoop fs</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>-appendToFile <span class="token operator">&lt;</span>localsrc<span class="token operator">&gt;</span> <span class="token punctuation">..</span>. <span class="token operator">&lt;</span>dst<span class="token operator">&gt;</span><span class="token punctuation">]</span> 

<span class="token punctuation">[</span>-cat <span class="token punctuation">[</span>-ignoreCrc<span class="token punctuation">]</span> <span class="token operator">&lt;</span>src<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span> 

<span class="token punctuation">[</span>-checksum <span class="token operator">&lt;</span>src<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span>

<span class="token punctuation">[</span>-chgrp <span class="token punctuation">[</span>-R<span class="token punctuation">]</span> GROUP <span class="token environment constant">PATH</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>

<span class="token punctuation">[</span>-chmod <span class="token punctuation">[</span>-R<span class="token punctuation">]</span> <span class="token operator">&lt;</span>MODE<span class="token punctuation">[</span>,MODE<span class="token punctuation">]</span><span class="token punctuation">..</span>. <span class="token operator">|</span> OCTALMODE<span class="token operator">&gt;</span> <span class="token environment constant">PATH</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span> 

<span class="token punctuation">[</span>-chown <span class="token punctuation">[</span>-R<span class="token punctuation">]</span> <span class="token punctuation">[</span>OWNER<span class="token punctuation">]</span><span class="token punctuation">[</span>:<span class="token punctuation">[</span>GROUP<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token environment constant">PATH</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span> 

<span class="token punctuation">[</span>-copyFromLocal <span class="token punctuation">[</span>-f<span class="token punctuation">]</span> <span class="token punctuation">[</span>-p<span class="token punctuation">]</span> <span class="token operator">&lt;</span>localsrc<span class="token operator">&gt;</span> <span class="token punctuation">..</span>. <span class="token operator">&lt;</span>dst<span class="token operator">&gt;</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>-copyToLocal <span class="token punctuation">[</span>-p<span class="token punctuation">]</span> <span class="token punctuation">[</span>-ignoreCrc<span class="token punctuation">]</span> <span class="token punctuation">[</span>-crc<span class="token punctuation">]</span> <span class="token operator">&lt;</span>src<span class="token operator">&gt;</span> <span class="token punctuation">..</span>. <span class="token operator">&lt;</span>localdst<span class="token operator">&gt;</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>-count <span class="token punctuation">[</span>-q<span class="token punctuation">]</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span>

<span class="token punctuation">[</span>-cp <span class="token punctuation">[</span>-f<span class="token punctuation">]</span> <span class="token punctuation">[</span>-p<span class="token punctuation">]</span> <span class="token operator">&lt;</span>src<span class="token operator">&gt;</span> <span class="token punctuation">..</span>. <span class="token operator">&lt;</span>dst<span class="token operator">&gt;</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>-createSnapshot <span class="token operator">&lt;</span>snapshotDir<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>snapshotName<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> 

<span class="token punctuation">[</span>-deleteSnapshot <span class="token operator">&lt;</span>snapshotDir<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>snapshotName<span class="token operator">&gt;</span><span class="token punctuation">]</span> 

<span class="token punctuation">[</span>-df <span class="token punctuation">[</span>-h<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>path<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>-du <span class="token punctuation">[</span>-s<span class="token punctuation">]</span> <span class="token punctuation">[</span>-h<span class="token punctuation">]</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span> 

<span class="token punctuation">[</span>-expunge<span class="token punctuation">]</span>

<span class="token punctuation">[</span>-get <span class="token punctuation">[</span>-p<span class="token punctuation">]</span> <span class="token punctuation">[</span>-ignoreCrc<span class="token punctuation">]</span> <span class="token punctuation">[</span>-crc<span class="token punctuation">]</span> <span class="token operator">&lt;</span>src<span class="token operator">&gt;</span> <span class="token punctuation">..</span>. <span class="token operator">&lt;</span>localdst<span class="token operator">&gt;</span><span class="token punctuation">]</span> 

<span class="token punctuation">[</span>-getfacl <span class="token punctuation">[</span>-R<span class="token punctuation">]</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>-getmerge <span class="token punctuation">[</span>-nl<span class="token punctuation">]</span> <span class="token operator">&lt;</span>src<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>localdst<span class="token operator">&gt;</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>-help <span class="token punctuation">[</span>cmd <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>-ls <span class="token punctuation">[</span>-d<span class="token punctuation">]</span> <span class="token punctuation">[</span>-h<span class="token punctuation">]</span> <span class="token punctuation">[</span>-R<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>path<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span> 

<span class="token punctuation">[</span>-mkdir <span class="token punctuation">[</span>-p<span class="token punctuation">]</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span>

<span class="token punctuation">[</span>-moveFromLocal <span class="token operator">&lt;</span>localsrc<span class="token operator">&gt;</span> <span class="token punctuation">..</span>. <span class="token operator">&lt;</span>dst<span class="token operator">&gt;</span><span class="token punctuation">]</span> 

<span class="token punctuation">[</span>-moveToLocal <span class="token operator">&lt;</span>src<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>localdst<span class="token operator">&gt;</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>-mv <span class="token operator">&lt;</span>src<span class="token operator">&gt;</span> <span class="token punctuation">..</span>. <span class="token operator">&lt;</span>dst<span class="token operator">&gt;</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>-put <span class="token punctuation">[</span>-f<span class="token punctuation">]</span> <span class="token punctuation">[</span>-p<span class="token punctuation">]</span> <span class="token operator">&lt;</span>localsrc<span class="token operator">&gt;</span> <span class="token punctuation">..</span>. <span class="token operator">&lt;</span>dst<span class="token operator">&gt;</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>-renameSnapshot <span class="token operator">&lt;</span>snapshotDir<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>oldName<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>newName<span class="token operator">&gt;</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>-rm <span class="token punctuation">[</span>-f<span class="token punctuation">]</span> <span class="token punctuation">[</span>-r<span class="token operator">|</span>-R<span class="token punctuation">]</span> <span class="token punctuation">[</span>-skipTrash<span class="token punctuation">]</span> <span class="token operator">&lt;</span>src<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span>

<span class="token punctuation">[</span>-rmdir <span class="token punctuation">[</span>--ignore-fail-on-non-empty<span class="token punctuation">]</span> <span class="token operator">&lt;</span>dir<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span>

<span class="token punctuation">[</span>-setfacl <span class="token punctuation">[</span>-R<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>-b<span class="token operator">|</span>-k<span class="token punctuation">}</span> <span class="token punctuation">{</span>-m<span class="token operator">|</span>-x <span class="token operator">&lt;</span>acl_spec<span class="token operator">&gt;</span><span class="token punctuation">}</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">|</span><span class="token punctuation">[</span>--set <span class="token operator">&lt;</span>acl_spec<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>-setrep <span class="token punctuation">[</span>-R<span class="token punctuation">]</span> <span class="token punctuation">[</span>-w<span class="token punctuation">]</span> <span class="token operator">&lt;</span>rep<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span> 

<span class="token punctuation">[</span>-stat <span class="token punctuation">[</span>format<span class="token punctuation">]</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span>

<span class="token punctuation">[</span>-tail <span class="token punctuation">[</span>-f<span class="token punctuation">]</span> <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>-test -<span class="token punctuation">[</span>defsz<span class="token punctuation">]</span> <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>-text <span class="token punctuation">[</span>-ignoreCrc<span class="token punctuation">]</span> <span class="token operator">&lt;</span>src<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span>

<span class="token punctuation">[</span>-touchz <span class="token operator">&lt;</span>path<span class="token operator">&gt;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span> 

<span class="token punctuation">[</span>-usage <span class="token punctuation">[</span>cmd <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><p>3）常用命令实操</p> <p>（0）启动 Hadoop 集群（方便后续的测试）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ sbin/start-dfs.sh <span class="token punctuation">[</span>root@hadoop02 hadoop-2.7.2<span class="token punctuation">]</span>$ sbin/start-yarn.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（1）-help：输出这个命令参数</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-help</span> <span class="token function">rm</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（2）-ls: 显示目录信息</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-ls</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（3）-mkdir：在 hdfs 上创建目录</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-mkdir</span> <span class="token parameter variable">-p</span> /sanguo/shuguo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（4）-moveFromLocal 从本地剪切粘贴到 hdfs</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ <span class="token function">touch</span> kongming.txt

<span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-moveFromLocal</span> ./kongming.txt /sanguo/shuguo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>（5）--appendToFile ：追加一个文件到已经存在的文件末尾</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ <span class="token function">touch</span> liubei.txt <span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ <span class="token function">vi</span> liubei.txt

输入 san gu mao lu

<span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-appendToFile</span> liubei.txt /sanguo/shuguo/kongming.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>（6）-cat ：显示文件内容</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-cat</span> /sanguo/shuguo/kongming.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（7）-tail：显示一个文件的末尾</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-tail</span> /sanguo/shuguo/kongming.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（8）-chgrp 、-chmod、-chown：linux 文件系统中的用法一样，修改文件所属权限</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-chmod</span> <span class="token number">666</span> /sanguo/shuguo/kongming.txt

<span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-chown</span> root:root /sanguo/shuguo/kongming.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>（9）-copyFromLocal：从本地文件系统中拷贝文件到 hdfs 路径去</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-copyFromLocal</span> README.txt 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（10）-copyToLocal：从 hdfs 拷贝到本地</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">\</span><span class="token punctuation">]</span><span class="token punctuation">\</span>$ hadoop fs <span class="token parameter variable">-copyToLocal</span>

/sanguo/shuguo/kongming.txt ./
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>（11）-cp ：从 hdfs 的一个路径拷贝到 hdfs 的另一个路径</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop02 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-cp</span> /sanguo/shuguo/kongming.txt /zhuge.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（12）-mv：在 hdfs 目录中移动文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop02 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-mv</span> /zhuge.txt /sanguo/shuguo/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（13）-get：等同于 copyToLocal，就是从 hdfs 下载文件到本地</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-get</span> /sanguo/shuguo/kongming.txt ./
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（14）-getmerge ：合并下载多个文件，比如 hdfs 的目录 /aaa/下有多个文件:log.1,log.2,log.3,...</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-getmerge</span> /user/root/test/* ./zaiyiqi.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（15）-put：等同于 copyFromLocal</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-put</span> ./zaiyiqi.txt /user/root/test/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（16）-rm：删除文件或文件夹</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-rm</span> /user/root/test/jinlian2.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（17）-rmdir：删除空目录</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-mkdir</span> /test <span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-rmdir</span> /test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>（18）-du 统计文件夹的大小信息</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop01 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-du</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-h</span> /user/root/test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>2.7 K /user/root/test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop02 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-du</span> <span class="token parameter variable">-h</span> /user/root/test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>1.3 K /user/root/test/README.txt
15 /user/root/test/jinlian.txt
1.4 K /user/root/test/zaiyiqi.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>（19）-setrep：设置 hdfs 中文件的副本数量</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@hadoop02 hadoop-2.7.2<span class="token punctuation">]</span>$ hadoop fs <span class="token parameter variable">-setrep</span> <span class="token number">10</span> /sanguo/shuguo/kongming.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这里设置的副本数只是记录在 NameNode 的元数据中，是否真的会有这么多副本，还得看 DataNode 的数量。因为目前只有 3 台设备，最多也就 3 个副本，只有节点数的增加到 10 台时，副本数才能达到 10。</p> <h2 id="第-3-章-hdfs-客户端操作"><a href="#第-3-章-hdfs-客户端操作" class="header-anchor">#</a> 第 3 章 HDFS 客户端操作</h2> <h3 id="_3-1-hdfs-客户端环境准备"><a href="#_3-1-hdfs-客户端环境准备" class="header-anchor">#</a> 3.1 HDFS 客户端环境准备</h3> <p>1）根据自己电脑的操作系统拷贝对应的编译后的 hadoop jar 包到非中文路径（例如：D:\Develop\hadoop-2.7.2）。</p> <p>2）配置 HADOOP_HOME 环境变量</p> <p>2）配置 Path 环境变量</p> <p>4）创建一个 Maven 工程 HdfsClientDemo</p> <p>5）导入相应的依赖</p> <div class="language-XML line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 			 			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.8.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.7.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.7.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-hdfs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.7.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>6）创建包名：com.root.hdfs</p> <p>7）创建 HdfsClient 类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HdfsClient</span><span class="token punctuation">{</span> 
    <span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testMkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span><span class="token class-name">InterruptedException</span><span class="token punctuation">,</span><span class="token class-name">URISyntaxException</span><span class="token punctuation">{</span>

        <span class="token comment">// 1 获取文件系统</span>
        <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 配置在集群上运行</span>
        <span class="token comment">// configuration.set(&quot;fs.defaultFS&quot;, &quot;hdfs://hadoop01:9000&quot;); </span>
        <span class="token comment">// FileSystem fs = FileSystem.get(configuration);</span>

        <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span> <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URI</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://hadoop02:9000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> configuration<span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2 创建目录</span>
        fs<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/1108/daxian/banzhang&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3 关闭资源</span>
        fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>8）执行程序</p> <p>运行时需要配置用户名称</p> <p>客户端去操作 hdfs 时，是有一个用户身份的。默认情况下，hdfs 客户端 api 会从 jvm 中</p> <p>获取一个参数来作为自己的用户身份：</p> <p>-DHADOOP_USER_NAME=root，root 为用户名称。</p> <p>8）注意：如果 eclipse 打印不出日志，在控制台上只显示</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1.log4j:WARN No appenders could be found for logger (org.apache.hadoop.util.Shell). 

2.log4j:WARN Please initialize the log4j system properly.

3.log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>需要在项目的 src/main/resources 目录下，新建一个文件，命名为“log4j.properties”，在</p> <p>文件中填入</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">log4j.rootLogger</span><span class="token punctuation">=</span><span class="token value attr-value">INFO,stdout</span>
<span class="token key attr-name">log4j.appender.stdout</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.ConsoleAppender </span>
<span class="token key attr-name">log4j.appender.stdout.layout</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.PatternLayout log4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n </span>
<span class="token key attr-name">log4j.appender.logfile</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.FileAppender </span>
<span class="token key attr-name">log4j.appender.logfile.File</span><span class="token punctuation">=</span><span class="token value attr-value">target/spring.log </span>
<span class="token key attr-name">log4j.appender.logfile.layout</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.PatternLayout </span>
<span class="token key attr-name">log4j.appender.logfile.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token value attr-value">%d %p [%c] - %m%n</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_3-2-hdfs-的-api-操作"><a href="#_3-2-hdfs-的-api-操作" class="header-anchor">#</a> 3.2 HDFS 的 API 操作</h3> <h4 id="_3-2-0-抽取-hdfs-工具类"><a href="#_3-2-0-抽取-hdfs-工具类" class="header-anchor">#</a> 3.2.0 抽取 HDFS 工具类</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HdfsUtil</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileSystem</span> <span class="token function">getHDFSFs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span> <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span>
        <span class="token class-name">URI</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://doit01:8020&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> conf<span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> fs <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_3-2-1-hdfs-文件上传-测试参数优先级"><a href="#_3-2-1-hdfs-文件上传-测试参数优先级" class="header-anchor">#</a> 3.2.1 HDFS 文件上传（测试参数优先级）</h4> <p>1）编写源代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCopyFromLocalFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>   <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">URISyntaxException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1  获取文件系统</span>
    <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    configuration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;dfs.replication&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span>  <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URI</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://hadoop01:9000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  configuration<span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2  上传文件</span>
    fs<span class="token punctuation">.</span><span class="token function">copyFromLocalFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;e:/hello.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/hello.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3  关闭资源fs.close();</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;over&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>2）将 hdfs-site.xml 拷贝到项目的根目录下</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token prolog">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.replication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>	
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>3）参数优先级</p> <p>参数优先级排序： （1）客户端代码中设置的值 &gt;（2）<em>classpath</em> 下的用户自定义配置文件 &gt;（3）然后是服务器的默认配置</p> <h4 id="_3-2-2-hdfs-文件下载"><a href="#_3-2-2-hdfs-文件下载" class="header-anchor">#</a> 3.2.2 HDFS 文件下载</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCopyToLocalFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>	<span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">URISyntaxException</span><span class="token punctuation">{</span>
    <span class="token comment">// 1  获取文件系统</span>
    <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span>  <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URI</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://hadoop02:9000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  configuration<span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2  执行下载操作</span>
    <span class="token comment">// boolean delSrc 指是否将原文件删除</span>
    <span class="token comment">// Path src 指要下载的文件路径</span>
    <span class="token comment">// Path dst 指将文件下载到的路径</span>
    <span class="token comment">// boolean useRawLocalFileSystem 是否开启文件校验	</span>
    fs<span class="token punctuation">.</span><span class="token function">copyToLocalFile</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/hello1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;e:/hello1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3  关闭资源</span>
    fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="_3-2-3-hdfs-文件夹删除"><a href="#_3-2-3-hdfs-文件夹删除" class="header-anchor">#</a> 3.2.3 HDFS 文件夹删除</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span>	<span class="token function">testDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span>	<span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">URISyntaxException</span><span class="token punctuation">{</span>
    <span class="token comment">// 1  获取文件系统</span>
    <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span>  <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URI</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://hadoop01:9000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  configuration<span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2  执行删除</span>
    fs<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/1108/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3  关闭资源</span>
    fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_3-2-4-hdfs-文件名更改"><a href="#_3-2-4-hdfs-文件名更改" class="header-anchor">#</a> 3.2.4 HDFS 文件名更改</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testRename</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>	<span class="token class-name">IOException</span><span class="token punctuation">,</span><span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">URISyntaxException</span><span class="token punctuation">{</span>
    <span class="token comment">// 1  获取文件系统</span>
    <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span>  <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URI</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://hadoop02:9000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  configuration<span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2  修改文件名称</span>
    fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/hello.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/hello6.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3  关闭资源</span>
    fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_3-2-5-hdfs-文件详情查看"><a href="#_3-2-5-hdfs-文件详情查看" class="header-anchor">#</a> 3.2.5 HDFS 文件详情查看</h4> <p>查看文件名称、权限、长度、块信息</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testListFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token keyword">throws</span>	<span class="token class-name">IOException</span><span class="token punctuation">,</span><span class="token class-name">InterruptedException</span><span class="token punctuation">,</span><span class="token class-name">URISyntaxException</span><span class="token punctuation">{</span>
    <span class="token comment">// 1 获取文件系统</span>
    <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span>  <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URI</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://hadoop02:9000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  configuration<span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2  获取文件详情</span>
    <span class="token class-name">RemoteIterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LocatedFileStatus</span><span class="token punctuation">&gt;</span></span> listFiles <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>listFiles<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">LocatedFileStatus</span> status <span class="token operator">=</span> listFiles<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 文件名称</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">// 长度</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">getLen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 权限</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">getPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// z组</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">getGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取存储的块信息</span>
        <span class="token class-name">BlockLocation</span><span class="token punctuation">[</span><span class="token punctuation">]</span> blockLocations <span class="token operator">=</span> status<span class="token punctuation">.</span><span class="token function">getBlockLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BlockLocation</span> blockLocation <span class="token operator">:</span> blockLocations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取块存储的主机节点</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> hosts <span class="token operator">=</span> blockLocation<span class="token punctuation">.</span><span class="token function">getHosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> host <span class="token operator">:</span> hosts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;------班长的分割线------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h4 id="_3-2-6-hdfs-文件和文件夹判断"><a href="#_3-2-6-hdfs-文件和文件夹判断" class="header-anchor">#</a> 3.2.6 HDFS 文件和文件夹判断</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span>	<span class="token function">testListStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>	<span class="token class-name">IOException</span><span class="token punctuation">,</span>	<span class="token class-name">InterruptedException</span><span class="token punctuation">,</span><span class="token class-name">URISyntaxException</span><span class="token punctuation">{</span>

    <span class="token comment">// 1  获取文件配置信息</span>
    <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span>  <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URI</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://hadoop02:9000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  configuration<span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2  判断是文件还是文件夹</span>
    <span class="token class-name">FileStatus</span><span class="token punctuation">[</span><span class="token punctuation">]</span> listStatus <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">listStatus</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">FileStatus</span> fileStatus <span class="token operator">:</span> listStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果是文件</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileStatus<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 					 <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;f:&quot;</span><span class="token operator">+</span>fileStatus<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>   	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;d:&quot;</span><span class="token operator">+</span>fileStatus<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 3  关闭资源</span>
    fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_3-3-hdfs-的i-o-流操作"><a href="#_3-3-hdfs-的i-o-流操作" class="header-anchor">#</a> 3.3 HDFS 的I/O 流操作</h3> <h4 id="_3-3-1-hdfs-文件上传"><a href="#_3-3-1-hdfs-文件上传" class="header-anchor">#</a> 3.3.1 HDFS 文件上传</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">putFileToHDFS</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span><span class="token class-name">URISyntaxException</span> <span class="token punctuation">{</span>

    <span class="token comment">// 1 获取文件系统</span>
    <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span> <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URI</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://hadoop01:9000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> configuration<span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2 创建输入流</span>
    <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;e:/hello.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3 获取输出流</span>
    <span class="token class-name">FSDataOutputStream</span> fos <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/hello4.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4 流对拷</span>
    <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copyBytes</span><span class="token punctuation">(</span>fis<span class="token punctuation">,</span> fos<span class="token punctuation">,</span> configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5 关闭资源</span>
    <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">closeStream</span><span class="token punctuation">(</span>fis<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">closeStream</span><span class="token punctuation">(</span>fos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_3-3-2-hdfs-文件下载"><a href="#_3-3-2-hdfs-文件下载" class="header-anchor">#</a> 3.3.2 HDFS 文件下载</h4> <p>1）需求：从 HDFS 上下载文件到本地 e 盘上。</p> <p>2）编写代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getFileFromHDFS</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span><span class="token class-name">URISyntaxException</span><span class="token punctuation">{</span>

    <span class="token comment">// 1 获取文件系统</span>
    <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span> <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URI</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://hadoop02:9000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> configuration<span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2 获取输人流</span>
    <span class="token class-name">FSDataInputStream</span> fis <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/hello1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3 获取输出流</span>
    <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;e:/hello1.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4 流的对拷</span>
    <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copyBytes</span><span class="token punctuation">(</span>fis<span class="token punctuation">,</span> fos<span class="token punctuation">,</span> configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5 关闭资源</span>
    <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">closeStream</span><span class="token punctuation">(</span>fis<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">closeStream</span><span class="token punctuation">(</span>fos<span class="token punctuation">)</span><span class="token punctuation">;</span> fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_3-3-3-定位文件读取"><a href="#_3-3-3-定位文件读取" class="header-anchor">#</a> 3.3.3 定位文件读取</h4> <p>1）下载第一块</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readFileSeek1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span><span class="token class-name">URISyntaxException</span><span class="token punctuation">{</span>

    <span class="token comment">// 1 获取文件系统</span>
    <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span> <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URI</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://hadoop01:9000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> configuration<span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2 获取输入流</span>
    <span class="token class-name">FSDataInputStream</span> fis <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoop-2.7.2.tar.gz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3 创建输出流</span>
    <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span>
    <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;e:/hadoop-2.7.2.tar.gz.part1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4 流的拷贝</span>
    <span class="token keyword">byte</span>\<span class="token punctuation">[</span>\<span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span>\<span class="token punctuation">[</span><span class="token number">1024</span>\<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">;</span> i \<span class="token operator">&lt;</span> <span class="token number">1024</span> \<span class="token operator">*</span> <span class="token number">128</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        fis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 5 关闭资源</span>
    <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">closeStream</span><span class="token punctuation">(</span>fis<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">closeStream</span><span class="token punctuation">(</span>fos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>2）下载第二块</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readFileSeek2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span><span class="token class-name">URISyntaxException</span><span class="token punctuation">{</span>
    <span class="token comment">// 1 获取文件系统</span>
    <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span> <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URI</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://hadoop01:9000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> configuration<span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2 打开输入流</span>
    <span class="token class-name">FSDataInputStream</span> fis <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoop-2.7.2.tar.gz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3 定位输入数据位置</span>
    fis<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token number">1024</span>\<span class="token operator">*</span><span class="token number">1024</span>\<span class="token operator">*</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4 创建输出流</span>
    <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span>
    <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;e:/hadoop-2.7.2.tar.gz.part2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5 流的对拷</span>
    <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copyBytes</span><span class="token punctuation">(</span>fis<span class="token punctuation">,</span> fos<span class="token punctuation">,</span> configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 6 关闭资源</span>
    <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">closeStream</span><span class="token punctuation">(</span>fis<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">closeStream</span><span class="token punctuation">(</span>fos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>3）合并文件</p> <p>在 window 命令窗口中执行</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">type</span> hadoop-2.7.2.tar.gz.part2 <span class="token operator">&gt;&gt;</span> hadoop-2.7.2.tar.gz.part1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="第-4-章-hdfs-的数据流"><a href="#第-4-章-hdfs-的数据流" class="header-anchor">#</a> 第 4 章 HDFS 的数据流</h2> <h3 id="_4-1-hdfs-写数据流程"><a href="#_4-1-hdfs-写数据流程" class="header-anchor">#</a> 4.1 HDFS 写数据流程</h3> <h4 id="_4-1-1-剖析文件写入"><a href="#_4-1-1-剖析文件写入" class="header-anchor">#</a> 4.1.1 剖析文件写入</h4> <p>1）客户端通过 Distributed FileSystem 模块向 NameNode 请求上传文件，NameNode 检查目标文件是否已存在，父目录是否存在。</p> <p>2）NameNode 返回是否可以上传。</p> <p>3）客户端请求第一个 block 上传到哪几个 datanode 服务器上。</p> <p>4）NameNode 返回 3 个 datanode 节点，分别为 dn1、dn2、dn3。</p> <p>5）客户端通过 FSDataOutputStream 模块请求 dn1 上传数据，dn1 收到请求会继续调用 dn2，</p> <p>然后 dn2 调用 dn3，将这个通信管道建立完成。</p> <p>6）dn1、dn2、dn3 逐级应答客户端。</p> <p>7）客户端开始往 dn1 上传第一个 block（先从磁盘读取数据放到一个本地内存缓存），以packet 为单位，dn1 收到一个 packet 就会传给 dn2，dn2 传给 dn3；dn1 每传一个 packet 会放入一个应答队列等待应答。</p> <p>8）当一个 block 传输完成之后，客户端再次请求 NameNode 上传第二个 block 的服务器。（重复执行 3-7 步）。</p> <h3 id="_4-2-hdfs-读数据流程"><a href="#_4-2-hdfs-读数据流程" class="header-anchor">#</a> 4.2 HDFS 读数据流程</h3> <p>1）客户端通过 Distributed FileSystem 向 NameNode 请求下载文件，NameNode 通过查询元</p> <p>数据，找到文件块所在的 DataNode 地址。</p> <p>2）挑选一台 DataNode（就近原则，然后随机）服器，请求读取数据。</p> <p>3）DataNode 开始传输数据给客户端（从磁盘里面读取数据输入流，以 packet 为单位来做校验）。</p> <p>4）客户端以 packet 为单位接收，先在本地缓存，然后写入目标文件。</p> <h2 id="第-5-章-namenode-和-secondarynamenode"><a href="#第-5-章-namenode-和-secondarynamenode" class="header-anchor">#</a> 第 5 章 NameNode 和 SecondaryNameNode</h2> <h3 id="_5-1-nn-和-2nn-工作机制"><a href="#_5-1-nn-和-2nn-工作机制" class="header-anchor">#</a> 5.1 NN 和 2NN 工作机制</h3> <p>1）第一阶段：NameNode 启动</p> <p>（1）第一次启动 NameNode 格式化后，创建 fsimage 和 edits 文件。如果不是第一次启动，直接加载编辑日志和镜像文件到内存。</p> <p>（2）客户端对元数据进行增删改的请求。</p> <p>（3）NameNode 记录操作日志，更新滚动日志。</p> <p>（4）NameNode 在内存中对数据进行增删改查。</p> <p>2）第二阶段：Secondary NameNode 工作</p> <p>（1）Secondary NameNode 询问 NameNode 是否需要 checkpoint。直接带回 NameNode是否检查结果。</p> <p>（2）Secondary NameNode 请求执行 checkpoint。</p> <p>（3）NameNode 滚动正在写的 edits 日志。</p> <p>（4）将滚动前的编辑日志和镜像文件拷贝到 Secondary NameNode。</p> <p>（5）Secondary NameNode 加载编辑日志和镜像文件到内存，并合并。</p> <p>（6）生成新的镜像文件 fsimage.chkpoint。</p> <p>（7）拷贝 fsimage.chkpoint 到 NameNode。</p> <p>（8）NameNode 将 fsimage.chkpoint 重新命名成 fsimage。</p> <h2 id="第-6-章-datanode"><a href="#第-6-章-datanode" class="header-anchor">#</a> 第 6 章 DataNode</h2> <h3 id="_6-1-datanode-工作机制"><a href="#_6-1-datanode-工作机制" class="header-anchor">#</a> 6.1 DataNode 工作机制</h3> <p>1）一个数据块在 DataNode 上以文件形式存储在磁盘上，包括两个文件，一个是数据本身，一个是元数据包括数据块的长度，块数据的校验和，以及时间戳。</p> <p>2）DataNode 启动后向 NameNode 注册，通过后，周期性（1 小时）的向 NameNode 上报所有的块信息。</p> <p>3）心跳是每 3 秒一次，心跳返回结果带有 NameNode 给该 DataNode 的命令如复制块数据到另一台机器，或删除某个数据块。如果超过 10 分钟没有收到某个 DataNode 的心跳，则认为该节点不可用。</p> <p>4）集群运行中可以安全加入和退出一些机器。</p></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#第-1-章-hdfs-概述" class="sidebar-link reco-side-第-1-章-hdfs-概述" data-v-b57cc07c>第 1 章 HDFS 概述</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#_1-1-hdfs-产生背景" class="sidebar-link reco-side-_1-1-hdfs-产生背景" data-v-b57cc07c>1.1 HDFS 产生背景</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#_1-2-hdfs-概念" class="sidebar-link reco-side-_1-2-hdfs-概念" data-v-b57cc07c>1.2 HDFS 概念</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#_1-3-hdfs-优缺点" class="sidebar-link reco-side-_1-3-hdfs-优缺点" data-v-b57cc07c>1.3 HDFS 优缺点</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#_1-4-hdfs-组成架构" class="sidebar-link reco-side-_1-4-hdfs-组成架构" data-v-b57cc07c>1.4 HDFS 组成架构</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#_1-5-hdfs-文件块大小" class="sidebar-link reco-side-_1-5-hdfs-文件块大小" data-v-b57cc07c>1.5 HDFS 文件块大小</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#第-2-章-hfds-的-shell-操作" class="sidebar-link reco-side-第-2-章-hfds-的-shell-操作" data-v-b57cc07c>第 2 章 HFDS 的 Shell 操作</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#第-3-章-hdfs-客户端操作" class="sidebar-link reco-side-第-3-章-hdfs-客户端操作" data-v-b57cc07c>第 3 章 HDFS 客户端操作</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#_3-1-hdfs-客户端环境准备" class="sidebar-link reco-side-_3-1-hdfs-客户端环境准备" data-v-b57cc07c>3.1 HDFS 客户端环境准备</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#_3-2-hdfs-的-api-操作" class="sidebar-link reco-side-_3-2-hdfs-的-api-操作" data-v-b57cc07c>3.2 HDFS 的 API 操作</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#_3-3-hdfs-的i-o-流操作" class="sidebar-link reco-side-_3-3-hdfs-的i-o-流操作" data-v-b57cc07c>3.3 HDFS 的I/O 流操作</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#第-4-章-hdfs-的数据流" class="sidebar-link reco-side-第-4-章-hdfs-的数据流" data-v-b57cc07c>第 4 章 HDFS 的数据流</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#_4-1-hdfs-写数据流程" class="sidebar-link reco-side-_4-1-hdfs-写数据流程" data-v-b57cc07c>4.1 HDFS 写数据流程</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#_4-2-hdfs-读数据流程" class="sidebar-link reco-side-_4-2-hdfs-读数据流程" data-v-b57cc07c>4.2 HDFS 读数据流程</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#第-5-章-namenode-和-secondarynamenode" class="sidebar-link reco-side-第-5-章-namenode-和-secondarynamenode" data-v-b57cc07c>第 5 章 NameNode 和 SecondaryNameNode</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#_5-1-nn-和-2nn-工作机制" class="sidebar-link reco-side-_5-1-nn-和-2nn-工作机制" data-v-b57cc07c>5.1 NN 和 2NN 工作机制</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#第-6-章-datanode" class="sidebar-link reco-side-第-6-章-datanode" data-v-b57cc07c>第 6 章 DataNode</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/BigData/Hadoop%20HDFS%20%E5%8E%9F%E7%90%86.html#_6-1-datanode-工作机制" class="sidebar-link reco-side-_6-1-datanode-工作机制" data-v-b57cc07c>6.1 DataNode 工作机制</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----><div class="RibbonAnimation"></div><div></div></div></div>
    <script src="/assets/js/app.4c955a77.js" defer></script><script src="/assets/js/4.1f64e010.js" defer></script><script src="/assets/js/1.2b09ee83.js" defer></script><script src="/assets/js/18.a6042dc9.js" defer></script>
  </body>
</html>
